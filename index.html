<!DOCTYPE html>
<html lang="it">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Per Michelle</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://www.youtube.com/iframe_api"></script>
    <script>
        var ytPlayer = null;
        function onYouTubeIframeAPIReady() { /* pronta */ }
        function createYTPlayer() {
            ytPlayer = new YT.Player('yt-player', {
                videoId: 'LESn4LFOfes',
                playerVars: { autoplay: 1, mute: 1, rel: 0, modestbranding: 1 },
                events: {
                    onReady: function (e) {
                        e.target.playVideo();
                        setTimeout(function () { e.target.unMute(); e.target.setVolume(100); }, 1000);
                    }
                }
            });
        }
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&display=swap');

        body {
            font-family: 'Playfair Display', serif;
        }

        /* Animazione caduta cuori */
        @keyframes fall {
            0% {
                transform: translateY(-10vh) rotate(0deg);
                opacity: 0;
            }

            10% {
                opacity: 0.8;
            }

            90% {
                opacity: 0.8;
            }

            100% {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }

        .animate-fall {
            animation-name: fall;
            animation-timing-function: linear;
            animation-iteration-count: infinite;
        }

        /* Animazione entrata iframe */
        .fade-in-up {
            animation: fadeInUp 1.5s ease-out forwards;
            opacity: 0;
            transform: translateY(20px);
        }

        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>

<body class="bg-[#fffafa]">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        const App = () => {
            const [step, setStep] = useState(-1);
            const [showMain, setShowMain] = useState(false);
            const [elapsedTime, setElapsedTime] = useState({ hours: 0, minutes: 0, seconds: 0 });
            const [selectedHeart, setSelectedHeart] = useState(null);

            const startDate = new Date('2024-10-30T00:00:00');

            const introPhrases = [
                "Ciao Michelle",
                "Mi sono comportato in modo inaccettabile",
                "Ti prego perdonami",
                "Dammi un'altra occasione, non posso vivere senza di te"
            ];

            // Configurazione Cuori
            const hearts = useMemo(() => Array.from({ length: 30 }).map((_, i) => ({
                id: i,
                left: Math.random() * 98,
                delay: Math.random() * 15,
                duration: 8 + Math.random() * 12,
                size: 20 + Math.random() * 25,
                img: `https://images.unsplash.com/photo-1518199266791-5375a83190b7?w=600&h=600&fit=crop&sig=${i}`
            })), []);

            useEffect(() => {
                const updateTimer = () => {
                    const now = new Date();
                    const diff = now - startDate;
                    setElapsedTime({
                        hours: Math.floor(diff / (1000 * 60 * 60)),
                        minutes: Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60)),
                        seconds: Math.floor((diff % (1000 * 60)) / 1000)
                    });
                };
                updateTimer();
                const timer = setInterval(updateTimer, 1000);
                return () => clearInterval(timer);
            }, []);

            useEffect(() => {
                if (step >= 0 && step < introPhrases.length) {
                    const timeout = setTimeout(() => setStep(prev => prev + 1), 4000);
                    return () => clearTimeout(timeout);
                } else if (step === introPhrases.length) {
                    setTimeout(() => setShowMain(true), 1000);
                }
            }, [step]);

            const handleStart = () => {
                setStep(0);
            };

            return (
                <div className="min-h-screen text-rose-900 overflow-hidden relative selection:bg-rose-200">

                    {/* Schermata Iniziale */}
                    {!showMain && (
                        <div className="fixed inset-0 bg-white z-[100] flex flex-col items-center justify-center p-6 text-center">
                            {step === -1 ? (
                                <div className="flex flex-col items-center gap-6">
                                    <div className="text-rose-500 text-6xl animate-pulse">❤️</div>
                                    <button
                                        onClick={handleStart}
                                        className="px-12 py-4 bg-rose-500 text-white rounded-full text-xl shadow-xl hover:scale-105 transition-all active:scale-95 font-sans uppercase font-bold tracking-widest cursor-pointer z-50"
                                    >
                                        Apri per Michelle
                                    </button>
                                </div>
                            ) : (
                                introPhrases.map((phrase, index) => (
                                    <div key={index} className={`absolute transition-all duration-[2000ms] text-2xl md:text-5xl font-light px-4 ${step === index ? 'opacity-100 scale-100 blur-0' : 'opacity-0 scale-90 blur-xl'}`}>
                                        {phrase}
                                    </div>
                                ))
                            )}
                        </div>
                    )}

                    {/* Contenuto Principale */}
                    <div className={`transition-opacity duration-[3000ms] ${showMain ? 'opacity-100' : 'opacity-0'}`}>

                        {/* Layer Cuori Sfondo */}
                        <div className="fixed inset-0 pointer-events-none z-0 overflow-hidden">
                            {hearts.map((h) => (
                                <div key={h.id}
                                    className="absolute animate-fall cursor-pointer pointer-events-auto hover:scale-110 transition-transform"
                                    style={{
                                        left: `${h.left}%`,
                                        animationDuration: `${h.duration}s`,
                                        animationDelay: `-${h.delay}s`,
                                        top: '-10vh'
                                    }}
                                    onClick={() => setSelectedHeart(h)}>
                                    <span style={{ fontSize: h.size }} className="opacity-40 hover:opacity-100 transition-opacity drop-shadow-sm text-rose-300">❤️</span>
                                </div>
                            ))}
                        </div>

                        <main className="relative z-10 max-w-3xl mx-auto px-6 pt-12 pb-20 text-center min-h-screen flex flex-col items-center">
                            <h1 className="text-5xl md:text-7xl font-bold mb-8 text-rose-800 tracking-tighter drop-shadow-sm">Per Michelle</h1>

                            {/* Timer Box */}
                            <div className="bg-white/60 backdrop-blur-sm rounded-3xl p-8 shadow-lg border border-rose-100 mb-12 w-full max-w-md mx-4 transform hover:scale-105 transition-transform duration-500">
                                <p className="text-[10px] uppercase tracking-[0.4em] mb-4 text-rose-500 font-bold font-sans">Il tempo con te</p>
                                <div className="flex gap-4 md:gap-6 justify-center text-4xl font-light text-rose-700">
                                    <div className="flex flex-col w-20"><span>{elapsedTime.hours}</span><span className="text-[10px] uppercase font-sans font-bold opacity-40">Ore</span></div>
                                    <div className="opacity-20 mt-1">:</div>
                                    <div className="flex flex-col w-20"><span>{elapsedTime.minutes}</span><span className="text-[10px] uppercase font-sans font-bold opacity-40">Min</span></div>
                                    <div className="opacity-20 mt-1">:</div>
                                    <div className="flex flex-col w-20"><span>{elapsedTime.seconds}</span><span className="text-[10px] uppercase font-sans font-bold opacity-40">Sec</span></div>
                                </div>
                            </div>

                            {/* Lettera */}
                            <article className="prose prose-rose text-lg leading-relaxed text-left bg-white/90 backdrop-blur-2xl p-8 md:p-12 rounded-[3rem] shadow-2xl border border-white mx-4 mb-16 w-full">
                                <h2 className="text-3xl font-serif font-bold mb-8 text-center italic text-rose-800">Cara Michelle,</h2>
                                <div className="space-y-6 text-rose-950 font-serif text-xl">
                                    <p>Scrivo queste righe perché ci sono momenti in cui le parole dette a voce sembrano non bastare a colmare il vuoto che ho creato.</p>
                                    <p>Dal 30 ottobre 2024, ogni giorno è stato un capitolo di una storia bellissima, la nostra. Mi rendo conto di aver commesso degli errori pesanti, di essermi comportato in un modo che non rispecchia l'amore immenso che provo per te.</p>
                                    <p>Ti chiedo scusa con tutto me stesso. Non sono perfetto, ma so che senza di te la mia vita perde i suoi colori più belli. Sei la mia forza, il mio sorriso e la persona con cui voglio condividere ogni istante.</p>
                                    <p>Dammi l'opportunità di rimediare, di dimostrarti che posso essere l'uomo che meriti. Non smetterò mai di lottare per noi.</p>
                                </div>
                                <div className="text-right font-bold mt-12 text-rose-600 italic text-2xl">
                                    Con tutto il mio amore.
                                </div>
                            </article>

                            {/* Video Youtube CON AUDIO */}
                            {showMain && (
                                <div className="w-full max-w-2xl fade-in-up" style={{ animationDelay: '1s' }} ref={(el) => { if (el && !window._ytCreated) { window._ytCreated = true; setTimeout(createYTPlayer, 500); } }}>
                                    <div className="relative w-full aspect-video rounded-[2rem] overflow-hidden shadow-2xl border-4 border-white bg-black">
                                        <div id="yt-player" style={{ width: '100%', height: '100%' }}></div>
                                    </div>
                                </div>
                            )}

                        </main>
                    </div>

                    {/* Modal Cuore Click */}
                    {selectedHeart && (
                        <div className="fixed inset-0 z-[200] bg-rose-950/40 backdrop-blur-md flex items-center justify-center p-4 transition-all" onClick={() => setSelectedHeart(null)}>
                            <div className="bg-white rounded-[2rem] overflow-hidden max-w-sm w-full shadow-2xl transform transition-all scale-100" onClick={e => e.stopPropagation()}>
                                <div className="relative h-64 overflow-hidden">
                                    <img src={selectedHeart.img} className="w-full h-full object-cover" />
                                    <button onClick={() => setSelectedHeart(null)} className="absolute top-4 right-4 bg-white/80 p-2 rounded-full text-rose-900 font-bold shadow-md hover:bg-white">✕</button>
                                </div>
                                <div className="p-8 text-center bg-white">
                                    <div className="text-rose-500 mb-4 text-4xl">❤️</div>
                                    <p className="text-rose-900 italic text-xl font-serif">"Sei la cosa più bella che ho."</p>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>

</html>
